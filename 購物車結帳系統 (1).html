<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å®Œæ•´è³¼ç‰©æµç¨‹</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 2em;
      background-color: #f9f9f9;
      color: #2e7d32;
      display: flex;
      justify-content: center;
    }
    .container {
      max-width: 600px;
      width: 100%;
      background: #ffffff;
      padding: 2em;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    }
    .section {
      display: none;
    }
    .active {
      display: block;
    }
    .form-group {
      margin-bottom: 1em;
    }
    .form-group label {
      display: block;
      margin-bottom: 0.3em;
    }
    input, select {
      padding: 0.5em;
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-sizing: border-box;
    }
    .progress {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2em;
    }
    .progress span {
      width: 100%;
      text-align: center;
      position: relative;
      color: #ccc;
      font-weight: bold;
    }
    .progress span::before {
      content: '';
      display: block;
      height: 4px;
      background: #ddd;
      position: absolute;
      top: -10px;
      left: 0;
      right: 0;
    }
    .progress .active {
      color: #2e7d32;
    }
    .progress .active::before {
      background: #2e7d32;
    }
    button {
      background-color: #2e7d32;
      color: white;
      border: none;
      padding: 0.6em 1.2em;
      margin: 1em 0.5em 0 0;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1em;
    }
    button:hover {
      background-color: #276c2c;
    }
    h2 {
      color: #2e7d32;
    }
    .back-home-btn {
      position: absolute;
      left: 0;
      background-color: #548a58;
      color: white;
      padding: 8px 14px;
      border-radius: 6px;
      text-decoration: none;
      font-size: 14px;
      font-weight: bold;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      transition: background-color 0.3s ease;
    }
    .back-home-btn:hover {
      background-color: #3c8040;
    }
    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5em 0;
      border-bottom: 1px solid #eee;
    }
    .cart-item button {
      background-color: #d32f2f;
      padding: 0.3em 0.6em;
      font-size: 0.9em;
    }
    .cart-item button:hover {
      background-color: #b71c1c;
    }
    #store-group a {
      display: inline-block;
      margin-top: 0.5em;
      color: #0077cc;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="progress">
      <span id="step1" class="active">è³¼ç‰©è»Š</span>
      <span id="step2">å¡«å¯«è³‡æ–™</span>
      <span id="step3">ç¢ºèª</span>
    </div>

    <div id="cart" class="section active">
      <h2>è³¼ç‰©è»Š</h2>
      <ul id="cart-items"></ul>
      <p>ç¸½é‡‘é¡ï¼š$<span id="cart-total">0</span></p>
      <button onclick="nextStep('checkout')">ä¸‹ä¸€æ­¥</button>
      <a href="https://sherry5151.github.io/shop/shop/%E5%A4%9A%E5%80%8B%E4%BD%BF%E7%94%A8%E8%80%85%E5%85%B1%E4%BA%AB.html" class="cart-button">ğŸ›’ è³¼ç‰©è»Š</a>
    </div>

    <div id="checkout" class="section">
      <h2>å¡«å¯«è³‡æ–™</h2>
      <form id="checkout-form" onsubmit="event.preventDefault(); saveData();">
        <div class="form-group">
          <label>å§“åï¼š</label>
          <input type="text" id="name" required>
        </div>
        <div class="form-group">
          <label>æ‰‹æ©Ÿè™Ÿç¢¼ï¼š</label>
          <input type="tel" id="phone" required>
        </div>
        <div class="form-group">
          <label>é›»å­éƒµä»¶ï¼š</label>
          <input type="email" id="email" required>
        </div>
        <div class="form-group">
          <label>ä»˜æ¬¾æ–¹å¼ï¼š</label>
          <select id="payment" onchange="updateDeliveryOptions()">
            <option value="credit">ä¿¡ç”¨å¡</option>
            <option value="atm">ATM è½‰å¸³</option>
            <option value="cod">è²¨åˆ°ä»˜æ¬¾</option>
          </select>
        </div>
        <div class="form-group" id="credit-group" style="display:none;">
          <label>å¡è™Ÿï¼š</label>
          <input type="text" id="card-number" maxlength="16">
          <label>åˆ°æœŸæ—¥ (MM/YY)ï¼š</label>
          <input type="text" id="card-exp" placeholder="MM/YY" pattern="\d{2}/\d{2}">
          <label>å®‰å…¨ç¢¼ï¼š</label>
          <input type="text" id="card-cvc" maxlength="4">
        </div>
        <div class="form-group" id="atm-group" style="display:none;">
          <label>éŠ€è¡Œä»£ç¢¼ï¼š</label>
          <select id="bank-code">
            <option value="004">004 å°ç£éŠ€è¡Œ</option>
            <option value="005">005 åœŸåœ°éŠ€è¡Œ</option>
            <option value="006">006 åˆä½œé‡‘åº«</option>
            <option value="007">007 ç¬¬ä¸€éŠ€è¡Œ</option>
            <option value="008">008 è¯å—éŠ€è¡Œ</option>
            <option value="009">009 å½°åŒ–éŠ€è¡Œ</option>
            <option value="011">011 ä¸Šæµ·å•†éŠ€</option>
            <option value="012">012 å°åŒ—å¯Œé‚¦</option>
            <option value="013">013 åœ‹æ³°ä¸–è¯</option>
            <option value="017">017 å…†è±éŠ€è¡Œ</option>
            <option value="021">021 èŠ±æ——éŠ€è¡Œ</option>
            <option value="822">822 ä¸­åœ‹ä¿¡è¨—</option>
          </select>
          <label>å¸³è™Ÿï¼š</label>
          <input type="text" id="bank-account">
        </div>
        <div class="form-group">
          <label>é…é€æ–¹å¼ï¼š</label>
          <select id="delivery" onchange="updateDeliveryOptions()">
            <option value="home">å®…é…åˆ°åºœ</option>
            <option value="711">7-11 å–è²¨</option>
          </select>
        </div>
        <div class="form-group" id="address-group">
          <label>åœ°å€ï¼š</label>
          <input type="text" id="address">
        </div>
        <div class="form-group" id="store-group">
          <label>é–€å¸‚åº—è™Ÿï¼š</label>
          <input type="text" id="store-code">
          <label>é–€å¸‚åº—åï¼š</label>
          <input type="text" id="store-name">
          <label>é–€å¸‚åœ°å€ï¼š</label>
          <input type="text" id="store-address">
          <a href="https://emap.pcsc.com.tw/emap.aspx#" target="_blank">æŸ¥è©¢ 7-11 é–€å¸‚åœ°åœ–</a>
        </div>
        <button type="button" onclick="prevStep('cart')">ä¸Šä¸€æ­¥</button>
        <button type="submit">ä¸‹ä¸€æ­¥</button>
      </form>
    </div>

    <div id="confirm" class="section">
      <h2>è¨‚å–®ç¢ºèª</h2>
      <p>å§“åï¼š<span id="c-name"></span></p>
      <p>æ‰‹æ©Ÿï¼š<span id="c-phone"></span></p>
      <p>ä¿¡ç®±ï¼š<span id="c-email"></span></p>
      <p>ä»˜æ¬¾æ–¹å¼ï¼š<span id="c-payment"></span></p>
      <p>é…é€æ–¹å¼ï¼š<span id="c-delivery"></span></p>
      <p id="confirm-address">åœ°å€ï¼š<span id="c-address"></span></p>
      <p id="confirm-store">é–€å¸‚ï¼š<span id="c-store"></span></p>
      <button onclick="prevStep('checkout')">ä¸Šä¸€æ­¥</button>
      <button onclick="submitOrder()">æäº¤è¨‚å–®</button>
      <button onclick="gohome()">è¿”å›é¦–é </button>
    </div>
  </div>

  <script>
    let cart = JSON.parse(localStorage.getItem('cartItems')) || [];

    function renderCart() {
      const cartItems = document.getElementById('cart-items');
      const cartTotal = document.getElementById('cart-total');
      cartItems.innerHTML = '';
      let total = 0;
      cart.forEach((item, index) => {
        const li = document.createElement('li');
        li.className = 'cart-item';
        li.innerHTML = `<span>${item.name} - $${item.price}</span><button onclick="removeItem(${index})">åˆªé™¤</button>`;
        total += parseFloat(item.price);
        cartItems.appendChild(li);
      });
      cartTotal.textContent = total;
    }

    function removeItem(index) {
  cart.splice(index, 1);
  localStorage.setItem('cartItems', JSON.stringify(cart)); // âœ… æ›´æ–° localStorage
  renderCart();
}

    function nextStep(id) {
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      updateProgress(id);
    }

    function prevStep(id) {
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      updateProgress(id);
    }

    function updateProgress(id) {
      document.getElementById('step1').classList.remove('active');
      document.getElementById('step2').classList.remove('active');
      document.getElementById('step3').classList.remove('active');
      if (id === 'cart') document.getElementById('step1').classList.add('active');
      if (id === 'checkout') document.getElementById('step2').classList.add('active');
      if (id === 'confirm') document.getElementById('step3').classList.add('active');
    }

    function updateDeliveryOptions() {
      const payment = document.getElementById('payment').value;
      const delivery = document.getElementById('delivery');
      const addressGroup = document.getElementById('address-group');
      const storeGroup = document.getElementById('store-group');
      const creditGroup = document.getElementById('credit-group');
      const atmGroup = document.getElementById('atm-group');

      if (payment === 'cod') {
        delivery.value = '711';
        delivery.disabled = true;
        creditGroup.style.display = 'none';
        atmGroup.style.display = 'none';
      } else {
        delivery.disabled = false;
        creditGroup.style.display = payment === 'credit' ? 'block' : 'none';
        atmGroup.style.display = payment === 'atm' ? 'block' : 'none';
      }

      if (delivery.value === 'home') {
        addressGroup.style.display = 'block';
        storeGroup.style.display = 'none';
      } else {
        addressGroup.style.display = 'none';
        storeGroup.style.display = 'block';
      }
    }

    function selectStore() {
      window.open('https://emap.pcsc.com.tw/emap.aspx#', 'storeMap', 'width=800,height=600');
    }

    function saveData() {
      const data = {
        name: document.getElementById('name').value,
        phone: document.getElementById('phone').value,
        email: document.getElementById('email').value,
        payment: document.getElementById('payment').value,
        delivery: document.getElementById('delivery').value,
        address: document.getElementById('address').value,
        store: `(${document.getElementById('store-code').value}) ${document.getElementById('store-name').value} - ${document.getElementById('store-address').value}`
      };
      localStorage.setItem('checkoutData', JSON.stringify(data));
      loadConfirmation();
      nextStep('confirm');
    }

    function loadConfirmation() {
      const data = JSON.parse(localStorage.getItem('checkoutData'));
      document.getElementById('c-name').textContent = data.name;
      document.getElementById('c-phone').textContent = data.phone;
      document.getElementById('c-email').textContent = data.email;
      document.getElementById('c-payment').textContent = data.payment;
      document.getElementById('c-delivery').textContent = data.delivery;

      // é¡¯ç¤ºå°æ‡‰åœ°å€æˆ–é–€å¸‚
      const addressBlock = document.getElementById('confirm-address');
      const storeBlock = document.getElementById('confirm-store');
      if (data.delivery === 'home') {
        addressBlock.style.display = 'block';
        storeBlock.style.display = 'none';
        document.getElementById('c-address').textContent = data.address;
      } else {
        addressBlock.style.display = 'none';
        storeBlock.style.display = 'block';
        document.getElementById('c-store').textContent = data.store;
      }
    }

    function submitOrder() {
      alert('è¨‚å–®å·²æäº¤ï¼');
    }

    function gohome() {
      window.location.href = "https://n5kiy2gr7f.mobirisesite.com/";
    }

    window.onload = function () {
      updateDeliveryOptions();
      renderCart();
    };
  </script>
</body>
</html>
